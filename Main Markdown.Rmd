---
title: "Final Project Draft"
author: "Dai, Mathew, Tian"
date: '2022-12-10'
output: pdf_document
---
##Project set up
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=60), tidy=TRUE)

#Load the packages
getwd()
library(tidyverse)
library(lubridate)
library(trend)
library(zoo)
library(reshape2)
library(reshape)

# Set theme
mytheme <- theme_classic() +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "right")
theme_set(mytheme)

#Import the emission dataset 
carbon <- read.csv("Carbon_Monoxide.csv", stringsAsFactors = TRUE)

nitrogen <- read.csv("Nitrogen_Oxide.csv", stringsAsFactors = TRUE)

#Import the car quantity dataset

Q2018 <- read.csv("vehicle-fuel-type-count-by-zip-code.csv", stringsAsFactors = TRUE)

Q2020 <- read.csv("vehicle-count-as-of-1-1-2020.csv", stringsAsFactors = TRUE)

Q2021 <- read.csv("vehicle-fuel-type-count-by-zip-code-2021.csv", stringsAsFactors = TRUE)
  
Q2022 <- read_csv("vehicle-fuel-type-count-by-zip-code-2022 (1).csv")
```

## Clean up the dataset

xxx briefly summarize what we do in this part

```{r}
#Find and combine vehicle numbers from different year data set and categorize with different fuel

Q2018$Vehicles <- as.numeric(Q2018$Vehicles)
unique(Q2018$Fuel)
sum(Q2018[which(Q2018$Fuel =="Gasoline"), 7])
sum(Q2018[which(Q2018$Fuel =="Diesel and Diesel Hybrid"), 7])
sum(Q2018[which(Q2018$Fuel =="Natural Gas"), 7])
sum(Q2018[which(Q2018$Fuel =="Hybrid Gasoline"), 7])
sum(Q2018[which(Q2018$Fuel =="Flex-Fuel"), 7])
sum(Q2018[which(Q2018$Fuel =="Battery Electric"), 7])
sum(Q2018[which(Q2018$Fuel =="Other"), 7])
sum(Q2018[which(Q2018$Fuel =="Plug-in Hybrid"), 7])
sum(Q2018[which(Q2018$Fuel =="Hydrogen Fuel Cell"), 7])

Q2020$Vehicles <- as.numeric(Q2020$Vehicles)
sum(Q2020[which(Q2020$Fuel =="Gasoline"), 7])
sum(Q2020[which(Q2020$Fuel =="Diesel and Diesel Hybrid"), 7])
sum(Q2020[which(Q2020$Fuel =="Natural Gas"), 7])
sum(Q2020[which(Q2020$Fuel =="Hybrid Gasoline"), 7])
sum(Q2020[which(Q2020$Fuel =="Flex-Fuel"), 7])
sum(Q2020[which(Q2020$Fuel =="Battery Electric"), 7])
sum(Q2020[which(Q2020$Fuel =="Other"), 7])
sum(Q2020[which(Q2020$Fuel =="Plug-in Hybrid"), 7])
sum(Q2020[which(Q2020$Fuel =="Hydrogen Fuel Cell"), 7])

Q2021$Vehicles <- as.numeric(Q2021$Vehicles)
sum(Q2021[which(Q2021$Fuel =="Gasoline"), 7])
sum(Q2021[which(Q2021$Fuel =="Diesel and Diesel Hybrid"), 7])
sum(Q2021[which(Q2021$Fuel =="Natural Gas"), 7])
sum(Q2021[which(Q2021$Fuel =="Hybrid Gasoline"), 7])
sum(Q2021[which(Q2021$Fuel =="Flex-Fuel"), 7])
sum(Q2021[which(Q2021$Fuel =="Battery Electric"), 7])
sum(Q2021[which(Q2021$Fuel =="Other"), 7])
sum(Q2021[which(Q2021$Fuel =="Plug-in Hybrid"), 7])
sum(Q2021[which(Q2021$Fuel =="Hydrogen Fuel Cell"), 7])

Q2022$Vehicles <- as.numeric(Q2022$Vehicles)
sum(Q2022[which(Q2022$Fuel =="Gasoline"), 7])
sum(Q2022[which(Q2022$Fuel =="Diesel and Diesel Hybrid"), 7])
sum(Q2022[which(Q2022$Fuel =="Natural Gas"), 7])
sum(Q2022[which(Q2022$Fuel =="Hybrid Gasoline"), 7])
sum(Q2022[which(Q2022$Fuel =="Flex-Fuel"), 7])
sum(Q2022[which(Q2022$Fuel =="Battery Electric"), 7])
sum(Q2022[which(Q2022$Fuel =="Other"), 7])
sum(Q2022[which(Q2022$Fuel =="Plug-in Hybrid"), 7])
sum(Q2022[which(Q2022$Fuel =="Hydrogen Fuel Cell"), 7])

#I used Q2018 data for both Y2018 and Y2019 since it was collected in October and others were collected in January
VehicleNumber.Fuel <- data.frame(Year = c("2018", "2019", "2020", "2021", "2022"),
                                 Gasoline = c("26978798", "26978798", "26985319", "25253808","26313272"),
                                 Diesel_Diesel_Hybrid = c("1282387", "1282387", "1271338", "1199349", "1306851"),
                                 Natural_Gas = c("34982", "34982", "29096", "10881", "31403"),
                                 Hybrid_Gasoline = c("1079558", "1079558", "1123090", "1181387", "1299331"),
                                 Flex_Fuel = c("1318691", "1318691", "1257292", "1259789", "1246662"),
                                 Battery_Electric = c("226614", "226614", "306803", "374865", "526266"),
                                 Other = c("7824", "7824", "5867", "47847", "3801"),
                                 Plug_in_Hybrid = c("204002", "204002", "248388", "264112", "305526"),
                                 Hydrogen_Fuel_Cell = c("5138", "5138", "6648", "7481", "10129"))

#Heavy or light duty in each fuel
#Gasoline
Q2018.gasoline <- 
  Q2018 %>%
  filter(Fuel == "Gasoline") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2018.gasoline[which(Q2018.gasoline$Duty =="Light"), 3])
sum(Q2018.gasoline[which(Q2018.gasoline$Duty =="Heavy"), 3])

Q2020.gasoline <- 
  Q2020 %>%
  filter(Fuel == "Gasoline") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2020.gasoline[which(Q2020.gasoline$Duty =="Light"), 3])
sum(Q2020.gasoline[which(Q2020.gasoline$Duty =="Heavy"), 3])

Q2021.gasoline <- 
  Q2021 %>%
  filter(Fuel == "Gasoline") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2021.gasoline[which(Q2021.gasoline$Duty =="Light"), 3])
sum(Q2021.gasoline[which(Q2021.gasoline$Duty =="Heavy"), 3])

Q2022.gasoline <- 
  Q2022 %>%
  filter(Fuel == "Gasoline") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2022.gasoline[which(Q2022.gasoline$Duty =="Light"), 3])
sum(Q2022.gasoline[which(Q2022.gasoline$Duty =="Heavy"), 3])

GasolineVehicle.Duty <- data.frame(Year = c("2018", "2019", "2020", "2021", "2022"),
                                   Heavy = c("292958", "292958", "295136", "261439", "265796"),
                                   Light = c("26685840", "26685840", "26690183", "23661814", "24741892"))

#Diesel and Diesel Hybrid
Q2018.diesel <- 
  Q2018 %>%
  filter(Fuel == "Diesel and Diesel Hybrid") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2018.diesel[which(Q2018.diesel$Duty =="Light"), 3])
sum(Q2018.diesel[which(Q2018.diesel$Duty =="Heavy"), 3])

Q2020.diesel <- 
  Q2020 %>%
  filter(Fuel == "Diesel and Diesel Hybrid") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2020.diesel[which(Q2020.diesel$Duty =="Light"), 3])
sum(Q2020.diesel[which(Q2020.diesel$Duty =="Heavy"), 3])

Q2021.diesel <- 
  Q2021 %>%
  filter(Fuel == "Diesel and Diesel Hybrid") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2021.diesel[which(Q2021.diesel$Duty =="Light"), 3])
sum(Q2021.diesel[which(Q2021.diesel$Duty =="Heavy"), 3])

Q2022.diesel <- 
  Q2022 %>%
  filter(Fuel == "Diesel and Diesel Hybrid") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2022.diesel[which(Q2022.diesel$Duty =="Light"), 3])
sum(Q2022.diesel[which(Q2022.diesel$Duty =="Heavy"), 3])

DieselVehicle.Duty <- data.frame(Year = c("2018", "2019", "2020", "2021", "2022"),
                                   Heavy = c("704568", "704568", "694293", "616207", "702098"),
                                   Light = c("577819", "577819", "577045", "541294", "554805"))

#Natural Gas
Q2018.naturalgas <- 
  Q2018 %>%
  filter(Fuel == "Natural Gas") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2018.naturalgas[which(Q2018.naturalgas$Duty =="Light"), 3])
sum(Q2018.naturalgas[which(Q2018.naturalgas$Duty =="Heavy"), 3])

Q2020.naturalgas <- 
  Q2020 %>%
  filter(Fuel == "Natural Gas") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2020.naturalgas[which(Q2020.naturalgas$Duty =="Light"), 3])
sum(Q2020.naturalgas[which(Q2020.naturalgas$Duty =="Heavy"), 3])

Q2021.naturalgas <- 
  Q2021 %>%
  filter(Fuel == "Natural Gas") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2021.naturalgas[which(Q2021.naturalgas$Duty =="Light"), 3])
sum(Q2021.naturalgas[which(Q2021.naturalgas$Duty =="Heavy"), 3])

Q2022.naturalgas <- 
  Q2022 %>%
  filter(Fuel == "Natural Gas") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2022.naturalgas[which(Q2022.naturalgas$Duty =="Light"), 3])
sum(Q2022.naturalgas[which(Q2022.naturalgas$Duty =="Heavy"), 3])

NaturalGasVehicle.Duty <- data.frame(Year = c("2018", "2019", "2020", "2021", "2022"),
                                   Heavy = c("20455", "20455", "17211", "7558", "22265"),
                                   Light = c("14527", "14527", "11885", "2042", "7738"))


#Hybrid Gasoline
Q2018.hybridgas <- 
  Q2018 %>%
  filter(Fuel == "Hybrid Gasoline") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2018.hybridgas[which(Q2018.hybridgas$Duty =="Light"), 3])
sum(Q2018.hybridgas[which(Q2018.hybridgas$Duty =="Heavy"), 3])

Q2020.hybridgas <- 
  Q2020 %>%
  filter(Fuel == "Hybrid Gasoline") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2020.hybridgas[which(Q2020.hybridgas$Duty =="Light"), 3])
sum(Q2020.hybridgas[which(Q2020.hybridgas$Duty =="Heavy"), 3])

Q2021.hybridgas <- 
  Q2021 %>%
  filter(Fuel == "Hybrid Gasoline") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2021.hybridgas[which(Q2021.hybridgas$Duty =="Light"), 3])
sum(Q2021.hybridgas[which(Q2021.hybridgas$Duty =="Heavy"), 3])

Q2022.hybridgas <- 
  Q2022 %>%
  filter(Fuel == "Hybrid Gasoline") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2022.hybridgas[which(Q2022.hybridgas$Duty =="Light"), 3])
sum(Q2022.hybridgas[which(Q2022.hybridgas$Duty =="Heavy"), 3])

HybridGasVehicle.Duty <- data.frame(Year = c("2018", "2019", "2020", "2021", "2022"),
                                   Heavy = c("0", "0", "0", "122", "117"),
                                   Light = c("1079558", "1079558", "1123090", "1180332", "1282219"))

#Flex-Fuel
Q2018.flexfuel <- 
  Q2018 %>%
  filter(Fuel == "Flex-Fuel") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2018.flexfuel[which(Q2018.flexfuel$Duty =="Light"), 3])
sum(Q2018.flexfuel[which(Q2018.flexfuel$Duty =="Heavy"), 3])

Q2020.flexfuel <- 
  Q2020 %>%
  filter(Fuel == "Flex-Fuel") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2020.flexfuel[which(Q2020.flexfuel$Duty =="Light"), 3])
sum(Q2020.flexfuel[which(Q2020.flexfuel$Duty =="Heavy"), 3])

Q2021.flexfuel <- 
  Q2021 %>%
  filter(Fuel == "Flex-Fuel") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2021.flexfuel[which(Q2021.flexfuel$Duty =="Light"), 3])
sum(Q2021.flexfuel[which(Q2021.flexfuel$Duty =="Heavy"), 3])

Q2022.flexfuel <- 
  Q2022 %>%
  filter(Fuel == "Flex-Fuel") %>%
  select(Fuel, Duty, Vehicles)
sum(Q2022.flexfuel[which(Q2022.flexfuel$Duty =="Light"), 3])
sum(Q2022.flexfuel[which(Q2022.flexfuel$Duty =="Heavy"), 3])

FlexFuelVehicle.Duty <- data.frame(Year = c("2018", "2019", "2020", "2021", "2022"),
                                   Heavy = c("28625", "28625", "30495", "35234", "36645"),
                                   Light = c("1290066", "1290066", "1226797", "1010212", "995624"))

view(VehicleNumber.Fuel)
view(GasolineVehicle.Duty)
view(DieselVehicle.Duty)
view(HybridGasVehicle.Duty)
view(NaturalGasVehicle.Duty)
view(FlexFuelVehicle.Duty)

#Creating Master Table for Vehicle data
GasolineVehicle.Duty_a <- GasolineVehicle.Duty %>%
  mutate(Fuel_Type = rep("Gasoline",5)) %>%
  mutate(Heavy = as.numeric(Heavy)) %>%
  mutate(Light = as.numeric(Light))

DieselVehicle.Duty_a <- DieselVehicle.Duty %>%
  mutate(Fuel_Type = rep("Diesel",5)) %>%
 mutate(Heavy = as.numeric(Heavy)) %>%
  mutate(Light = as.numeric(Light))

HybridGasVehicle.Duty_a <- HybridGasVehicle.Duty %>%
  mutate(Fuel_Type = rep("Hybrid Gas",5)) %>%
 mutate(Heavy = as.numeric(Heavy)) %>%
  mutate(Light = as.numeric(Light))

NaturalGasVehicle.Duty_a <- NaturalGasVehicle.Duty %>%
  mutate(Fuel_Type = rep("Natural Gas",5)) %>%
 mutate(Heavy = as.numeric(Heavy)) %>%
  mutate(Light = as.numeric(Light))

FlexFuelVehicle.Duty_a <- FlexFuelVehicle.Duty %>%
  mutate(Fuel_Type = rep("Flex Fuel",5)) %>%
 mutate(Heavy = as.numeric(Heavy)) %>%
  mutate(Light = as.numeric(Light))

Master_table_vehicles <- rbind(GasolineVehicle.Duty_a,DieselVehicle.Duty_a,HybridGasVehicle.Duty_a,NaturalGasVehicle.Duty_a,FlexFuelVehicle.Duty_a) %>%
  mutate(Total_vehicle = as.numeric(Light) + as.numeric(Heavy) ) %>%
  mutate(Share_Light = Light/Total_vehicle) %>%
  mutate(Share_Heavy = Heavy/Total_vehicle)

#Emission Data cleaning: select only on-road vehicles
Carbon.Monoxide <- carbon [carbon$CATEGORY == "ON-ROAD MOTOR VEHICLES", ]

Carbon.Monoxide <-
  Carbon.Monoxide %>%
  select(SUBCATEGORY, X2018, X2019, X2020, X2021, X2022)

COT <-
  Carbon.Monoxide %>%
  rownames_to_column() %>%
  gather(variable, value, -rowname) %>% 
  spread(rowname, value)

COT_delete <-
  Carbon.Monoxide %>%
  rownames_to_column() %>%
  gather(variable, value, -rowname) %>% 
  spread(rowname, value)

COT <- COT[, c(1, 2, 13, 16, 17, 18, 19, 20, 21, 22, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 15)]
colnames(COT) <- COT[1,]
COT <- COT[-1, ]
colnames(COT)[1] <- "Year"


Nitrogen.Oxide <- nitrogen [nitrogen$CATEGORY == "ON-ROAD MOTOR VEHICLES", ]

Nitrogen.Oxide <-
  Nitrogen.Oxide %>%
  select(SUBCATEGORY, X2018, X2019, X2020, X2021, X2022)

NOX <-
  Nitrogen.Oxide %>%
  rownames_to_column() %>%
  gather(variable, value, -rowname) %>% 
  spread(rowname, value)
NOX <- NOX[, c(1, 2, 13, 16, 17, 18, 19, 20, 21, 22, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 15)]
colnames(NOX) <- NOX[1,]
NOX <- NOX[-1, ]
colnames(NOX)[1] <- "Year"

view(COT)
view(NOX)

#Separate emission by factor "gas" and "diesel"
COT.gas <- 
  COT %>%
  select(c(1:9, 14, 16, 17, 19, 22))
COT.diesel <-
  COT %>%
  select(c(1, 10:13, 15, 18, 20, 21))

NOX.gas <- 
  NOX %>%
  select(c(1:9, 14, 16, 17, 19, 22))
NOX.diesel <-
  NOX %>%
  select(c(1, 10:13, 15, 18, 20, 21))

#Separate emission by factor "light duty" and "heavy duty"
#Any category containing "heavy duty" in their names is considered heavy, others(including buses) are light
COT.light <-
  COT %>%
  select (c(1:5, 14, 17:22))
COT.heavy <-
  COT %>%
  select(c(1, 6:13, 15, 16))

NOX.light <-
  NOX %>%
  select (c(1:5, 14, 17:22))
NOX.heavy <-
  NOX %>%
  select(c(1, 6:13, 15, 16))


#Change the Year column in COT and NOX datasets for plot use
COT.diesel$Year <- c(2018,2019,2020,2021,2022)
COT.gas$Year <- c(2018,2019,2020,2021,2022)
COT.heavy$Year <- c(2018,2019,2020,2021,2022)
COT.light$Year <- c(2018,2019,2020,2021,2022)
NOX.diesel$Year <- c(2018,2019,2020,2021,2022)
NOX.gas$Year <- c(2018,2019,2020,2021,2022)
NOX.heavy$Year <- c(2018,2019,2020,2021,2022)
NOX.light$Year <- c(2018,2019,2020,2021,2022)

```

## Analysis
1. Trend analysis: The quantity of different types of cars changes over the years (two graphs)
   add some description of the graph (like: which type has an obvious drop at what year)
2. Trend analysis: The emission changes over the years (carbon and nitrogen)
   add a paragraph, why we choose these two pollutant
   Ideally two graphs here
3. Regression analysis:
   combine diesel/carbon
   light duty/ heavy duty
   y = beta0 + beta1 x + error term
4.Something else

```{r, echo=FALSE}
#############Trend Analysis#############
###PART 1
#Number changes over the years
ds1 <- melt(VehicleNumber.Fuel,id="Year")
ds1$value <- as.numeric(ds1$value)
ds1_sub <- subset (ds1, variable != "Gasoline")
ds1_sub2 <- subset (ds1, variable == "Gasoline")

#plot #of cars changes over the years (Without gasoline)
ggplot(ds1_sub, aes(x=Year,y=value,group=variable,color=variable))+
  geom_point()+
  geom_line()+
  xlab("Year")+
  ylab("Quantity")+
  theme(legend.position = "right")+
  labs(color="Type of vehicles", title = paste("Change in the variety of vehicles across time"), subtitle = "Figure 1")

#plot #of cars changes over the years (Only gasoline)
#ps. Due to the quantity of gasoline cars is too large, we seperate it as an independent graph to present the quantity changes
ggplot(ds1_sub2, aes(x=Year,y=value,group=variable,color=variable))+
  geom_point()+
  geom_line()+
  xlab("Year")+
  ylab("Quantity")+
  theme(legend.position = "right")+
  labs(color="Type of vehicles", title = paste("Change in the gasoline vehicles across time"), subtitle = "Figure 2")

#trend of heavy and light duty cars over time

Master_table_vehicles_wogasoline <- subset (Master_table_vehicles, Fuel_Type != "Gasoline")

Master_table_vehicles_onlygasoline <- subset (Master_table_vehicles, Fuel_Type == "Gasoline")

#Heavy vehicle trend over time
ggplot(Master_table_vehicles, aes(x=Year,y=Share_Heavy,group=Fuel_Type,color=Fuel_Type))+
  geom_point()+
  geom_line()+
  xlab("Year")+
  ylab("Share of Heavy Vehicle")+
  theme(legend.position = "right")+
  labs(color="Type of vehicles", title = paste("Change in share of heavy duty vehicles across time"), subtitle = "Figure 3")

#Light vehicle trend over time
ggplot(Master_table_vehicles, aes(x=Year,y=Share_Light,group=Fuel_Type,color=Fuel_Type))+
  geom_point()+
  geom_line()+
  xlab("Year")+
  ylab("Share of Light Vehicle")+
  theme(legend.position = "right")+
  labs(color="Type of vehicles", title = paste("Change in share of light duty vehicles across time"), subtitle = "Figure 4")


###PART2
#carbon and nitrogen
#NOX.diesel
ds2_d <- melt(NOX.diesel,id="Year")
ds2_d$value <- as.numeric(ds2_d$value)
ggplot(ds2_d, aes(x=Year,y=value,group=variable,color=variable))+
  geom_point()+
  geom_line()+
  xlab("Year")+
  ylab("Emission")+
  theme(legend.position = "right",legend.key.size = unit(.5, 'cm'))+
  labs(color="Type of vehicles", title = paste("Trend of Nitrogen Oxide emission of diesel run vehicles across time"), subtitle = "Figure 5")

#NOX.gas
ds2_g <- melt(NOX.gas,id="Year")
ds2_g$value <- as.numeric(ds2_g$value)
ggplot(ds2_g, aes(x=Year,y=value,group=variable,color=variable))+
  geom_point()+
  geom_line()+
  xlab("Year")+
  ylab("Emission")+
  theme(legend.position = "right",legend.key.size = unit(.5, 'cm'))+
  labs(color="Type of vehicles", title = paste("Trend of Nitrogen Oxide emission of gas run vehicles across time"), subtitle = "Figure 6")

#NOX.light
ds2_l <- melt(NOX.light,id="Year")
ds2_l$value <- as.numeric(ds2_l$value)
ggplot(ds2_l, aes(x=Year,y=value,group=variable,color=variable))+
  geom_point()+
  geom_line()+
  xlab("Year")+
  ylab("Emission")+
  theme(legend.position = "right",legend.key.size = unit(.5, 'cm'))+
  labs(color="Type of vehicles", title = paste("Trend of Nitrogen Oxide emission of light-duty vehicles across time"), subtitle = "Figure 7")

#NOX.heavy
ds2_h <- melt(NOX.heavy,id="Year")
ds2_h$value <- as.numeric(ds2_h$value)
ggplot(ds2_h, aes(x=Year,y=value,group=variable,color=variable))+
  geom_point()+
  geom_line()+
  xlab("Year")+
  ylab("Emission")+
  theme(legend.position = "right",legend.key.size = unit(.5, 'cm'))+
  labs(color="Type of vehicles", title = paste("Trend of Nitrogen Oxide emission of heavy-duty vehicles across time"), subtitle = "Figure 8")

#COT
#COT.diesel
ds3_d <- melt(COT.diesel,id="Year")
ds3_d$value <- as.numeric(ds3_d$value)
ggplot(ds3_d, aes(x=Year,y=value,group=variable,color=variable))+
  geom_point()+
  geom_line()+
  xlab("Year")+
  ylab("Emission")+
  theme(legend.position = "right",legend.key.size = unit(.5, 'cm'))+
  labs(color="Type of vehicles", title = paste("Trend of Carbon Monoxide emission of diesel run vehicles across time"), subtitle = "Figure 9")

#COT.gas
ds3_g <- melt(COT.gas,id="Year")
ds3_g$value <- as.numeric(ds3_g$value)
ggplot(ds3_g, aes(x=Year,y=value,group=variable,color=variable))+
  geom_point()+
  geom_line()+
  xlab("Year")+
  ylab("Emission")+
  theme(legend.position = "right",legend.key.size = unit(.5, 'cm'))+
  labs(color="Type of vehicles", title = paste("Trend of Carbon Monoxide emission of gas run vehicles across time"), subtitle = "Figure 10")

#COT.light
ds3_l <- melt(COT.light,id="Year")
ds3_l$value <- as.numeric(ds3_l$value)
ggplot(ds3_l, aes(x=Year,y=value,group=variable,color=variable))+
  geom_point()+
  geom_line()+
  xlab("Year")+
  ylab("Emission")+
  theme(legend.position = "right",legend.key.size = unit(.5, 'cm'))+
  labs(color="Type of vehicles", title = paste("Trend of Carbon Monoxide emission of light duty vehicles across time"), subtitle = "Figure 11")

#COT.heavy
ds3_h <- melt(COT.heavy,id="Year")
ds3_h$value <- as.numeric(ds3_h$value)
ggplot(ds3_h, aes(x=Year,y=value,group=variable,color=variable))+
  geom_point()+
  geom_line()+
  xlab("Year")+
  ylab("Emission")+
  theme(legend.position = "right",legend.key.size = unit(.5, 'cm'))+
  labs(color="Type of vehicles",  title = paste("Trend of Carbon Monoxide emission of heavy duty vehicles across time"), subtitle = "Figure 12")
```


```{r, echo=FALSE}
#############Regression Analysis#############
# car quantity and emission
#COT.diesel
COT.diesel$`LIGHT HEAVY DUTY DIESEL TRUCKS - 1 (LHDDT1)` <- as.numeric(COT.diesel$`LIGHT HEAVY DUTY DIESEL TRUCKS - 1 (LHDDT1)`)
COT.diesel$`LIGHT HEAVY DUTY DIESEL TRUCKS - 2 (LHDDT2)` <- as.numeric(COT.diesel$`LIGHT HEAVY DUTY DIESEL TRUCKS - 2 (LHDDT2)`)
COT.diesel$`MEDIUM HEAVY DUTY DIESEL TRUCKS (MHDDT)` <- as.numeric(COT.diesel$`MEDIUM HEAVY DUTY DIESEL TRUCKS (MHDDT)`)
COT.diesel$`HEAVY HEAVY DUTY DIESEL TRUCKS (HHDDT)` <- as.numeric(COT.diesel$`HEAVY HEAVY DUTY DIESEL TRUCKS (HHDDT)`)
COT.diesel$`HEAVY DUTY DIESEL URBAN BUSES (UBD)` <- as.numeric(COT.diesel$`HEAVY DUTY DIESEL URBAN BUSES (UBD)`)
COT.diesel$`SCHOOL BUSES - DIESEL (SBD)` <- as.numeric(COT.diesel$`SCHOOL BUSES - DIESEL (SBD)`)
COT.diesel$`OTHER BUSES - MOTOR COACH - DIESEL (OBC)` <- as.numeric(COT.diesel$`OTHER BUSES - MOTOR COACH - DIESEL (OBC)`)
COT.diesel$`ALL OTHER BUSES - DIESEL (OBD)` <- as.numeric(COT.diesel$`ALL OTHER BUSES - DIESEL (OBD)`)

COT.diesel$sum <- COT.diesel$`LIGHT HEAVY DUTY DIESEL TRUCKS - 1 (LHDDT1)`+COT.diesel$`LIGHT HEAVY DUTY DIESEL TRUCKS - 2 (LHDDT2)`+COT.diesel$`MEDIUM HEAVY DUTY DIESEL TRUCKS (MHDDT)`+COT.diesel$`HEAVY HEAVY DUTY DIESEL TRUCKS (HHDDT)`+COT.diesel$`HEAVY DUTY DIESEL URBAN BUSES (UBD)`+COT.diesel$`SCHOOL BUSES - DIESEL (SBD)`+COT.diesel$`OTHER BUSES - MOTOR COACH - DIESEL (OBC)`+COT.diesel$`ALL OTHER BUSES - DIESEL (OBD)`

#COT.gas
COT.gas$`LIGHT DUTY PASSENGER (LDA)` <- as.numeric(COT.gas$`LIGHT DUTY PASSENGER (LDA)`)
COT.gas$`LIGHT DUTY TRUCKS - 1 (LDT1)` <- as.numeric (COT.gas$`LIGHT DUTY TRUCKS - 1 (LDT1)`)
COT.gas$`LIGHT DUTY TRUCKS - 2 (LDT2)` <- as.numeric (COT.gas$`LIGHT DUTY TRUCKS - 2 (LDT2)`)
COT.gas$`MEDIUM DUTY TRUCKS (MDV)`<- as.numeric (COT.gas$`MEDIUM DUTY TRUCKS (MDV)`)
COT.gas$`LIGHT HEAVY DUTY GAS TRUCKS - 1 (LHDGT1)` <- as.numeric(COT.gas$`LIGHT HEAVY DUTY GAS TRUCKS - 1 (LHDGT1)`)
COT.gas$`LIGHT HEAVY DUTY GAS TRUCKS - 2 (LHDGT2)` <- as.numeric(COT.gas$`LIGHT HEAVY DUTY GAS TRUCKS - 2 (LHDGT2)`)
COT.gas$`MEDIUM HEAVY DUTY GAS TRUCKS (MHDGT)` <- as.numeric(COT.gas$`MEDIUM HEAVY DUTY GAS TRUCKS (MHDGT)`)
COT.gas$`HEAVY HEAVY DUTY GAS TRUCKS (HHDGT)` <- as.numeric(COT.gas$`HEAVY HEAVY DUTY GAS TRUCKS (HHDGT)`)
COT.gas$`MOTORCYCLES (MCY)` <-as.numeric(COT.gas$`MOTORCYCLES (MCY)`)
COT.gas$`HEAVY DUTY GAS URBAN BUSES (UBG)` <- as.numeric(COT.gas$`HEAVY DUTY GAS URBAN BUSES (UBG)`)
COT.gas$`SCHOOL BUSES - GAS (SBG)`<-as.numeric(COT.gas$`SCHOOL BUSES - GAS (SBG)`)
COT.gas$`OTHER BUSES - GAS (OBG)` <-as.numeric(COT.gas$`OTHER BUSES - GAS (OBG)`)
COT.gas$`MOTOR HOMES (MH)`<-as.numeric(COT.gas$`MOTOR HOMES (MH)`)

COT.gas$sum <- COT.gas$`LIGHT DUTY PASSENGER (LDA)`+COT.gas$`LIGHT DUTY TRUCKS - 1 (LDT1)` +COT.gas$`LIGHT DUTY TRUCKS - 2 (LDT2)`+COT.gas$`MEDIUM DUTY TRUCKS (MDV)`+COT.gas$`LIGHT HEAVY DUTY GAS TRUCKS - 1 (LHDGT1)`+COT.gas$`LIGHT HEAVY DUTY GAS TRUCKS - 2 (LHDGT2)` +COT.gas$`MEDIUM HEAVY DUTY GAS TRUCKS (MHDGT)`+COT.gas$`HEAVY HEAVY DUTY GAS TRUCKS (HHDGT)` +COT.gas$`MOTORCYCLES (MCY)`+COT.gas$`HEAVY DUTY GAS URBAN BUSES (UBG)`+COT.gas$`SCHOOL BUSES - GAS (SBG)`+COT.gas$`OTHER BUSES - GAS (OBG)`+COT.gas$`MOTOR HOMES (MH)`

ds4 <- data.frame(COT.diesel$Year,COT.diesel$sum,VehicleNumber.Fuel$Diesel_Diesel_Hybrid,COT.gas$sum,VehicleNumber.Fuel$Gasoline)
ds4$Quantity.diesel <-ds4$VehicleNumber.Fuel.Diesel_Diesel_Hybrid
ds4$Emission.diesel <-ds4$COT.diesel.sum
ds4$Quantity.gas <-ds4$VehicleNumber.Fuel.Gasoline
ds4$Emission.gas <-ds4$COT.gas.sum

ds4$Quantity.diesel <- as.numeric(ds4$Quantity.diesel)
ds4$Quantity.gas <- as.numeric(ds4$Quantity.gas)

reg1 <- lm(data = ds4, Emission.diesel ~ Quantity.diesel)
summary(reg1)

reg2 <- lm(ds4$Emission.gas ~ ds4$Quantity.gas)
summary(reg2)

#Coefficient (absolute value) for gas is much higher than diesel, thus gas vehicle produces more COT emission

#NOX here
#Nox.giesel
NOX.diesel$`LIGHT HEAVY DUTY DIESEL TRUCKS - 1 (LHDDT1)` <- as.numeric(NOX.diesel$`LIGHT HEAVY DUTY DIESEL TRUCKS - 1 (LHDDT1)`)
NOX.diesel$`LIGHT HEAVY DUTY DIESEL TRUCKS - 2 (LHDDT2)` <- as.numeric(NOX.diesel$`LIGHT HEAVY DUTY DIESEL TRUCKS - 2 (LHDDT2)`)
NOX.diesel$`MEDIUM HEAVY DUTY DIESEL TRUCKS (MHDDT)` <- as.numeric(NOX.diesel$`MEDIUM HEAVY DUTY DIESEL TRUCKS (MHDDT)`)
NOX.diesel$`HEAVY HEAVY DUTY DIESEL TRUCKS (HHDDT)` <- as.numeric(NOX.diesel$`HEAVY HEAVY DUTY DIESEL TRUCKS (HHDDT)`)
NOX.diesel$`HEAVY DUTY DIESEL URBAN BUSES (UBD)` <- as.numeric(NOX.diesel$`HEAVY DUTY DIESEL URBAN BUSES (UBD)`)
NOX.diesel$`SCHOOL BUSES - DIESEL (SBD)` <- as.numeric(NOX.diesel$`SCHOOL BUSES - DIESEL (SBD)`)
NOX.diesel$`OTHER BUSES - MOTOR COACH - DIESEL (OBC)` <- as.numeric(NOX.diesel$`ALL OTHER BUSES - DIESEL (OBD)`)

NOX.diesel$sum <- NOX.diesel$`LIGHT HEAVY DUTY DIESEL TRUCKS - 1 (LHDDT1)`+NOX.diesel$`LIGHT HEAVY DUTY DIESEL TRUCKS - 2 (LHDDT2)`+NOX.diesel$`MEDIUM HEAVY DUTY DIESEL TRUCKS (MHDDT)`+NOX.diesel$`HEAVY HEAVY DUTY DIESEL TRUCKS (HHDDT)` +NOX.diesel$`HEAVY DUTY DIESEL URBAN BUSES (UBD)`+NOX.diesel$`SCHOOL BUSES - DIESEL (SBD)`+NOX.diesel$`OTHER BUSES - MOTOR COACH - DIESEL (OBC)`

#NOX.gas
NOX.gas$`LIGHT DUTY PASSENGER (LDA)` <- as.numeric(NOX.gas$`LIGHT DUTY PASSENGER (LDA)`)
NOX.gas$`LIGHT DUTY TRUCKS - 1 (LDT1)` <- as.numeric (NOX.gas$`LIGHT DUTY TRUCKS - 1 (LDT1)`)
NOX.gas$`LIGHT DUTY TRUCKS - 2 (LDT2)` <- as.numeric (NOX.gas$`LIGHT DUTY TRUCKS - 2 (LDT2)`)
NOX.gas$`MEDIUM DUTY TRUCKS (MDV)`<- as.numeric (NOX.gas$`MEDIUM DUTY TRUCKS (MDV)`)
NOX.gas$`LIGHT HEAVY DUTY GAS TRUCKS - 1 (LHDGT1)` <- as.numeric(NOX.gas$`LIGHT HEAVY DUTY GAS TRUCKS - 1 (LHDGT1)`)
NOX.gas$`LIGHT HEAVY DUTY GAS TRUCKS - 2 (LHDGT2)` <- as.numeric(NOX.gas$`LIGHT HEAVY DUTY GAS TRUCKS - 2 (LHDGT2)`)
NOX.gas$`MEDIUM HEAVY DUTY GAS TRUCKS (MHDGT)` <- as.numeric(NOX.gas$`MEDIUM HEAVY DUTY GAS TRUCKS (MHDGT)`)
NOX.gas$`HEAVY HEAVY DUTY GAS TRUCKS (HHDGT)` <- as.numeric(NOX.gas$`HEAVY HEAVY DUTY GAS TRUCKS (HHDGT)`)
NOX.gas$`MOTORCYCLES (MCY)` <-as.numeric(NOX.gas$`MOTORCYCLES (MCY)`)
NOX.gas$`HEAVY DUTY GAS URBAN BUSES (UBG)` <- as.numeric(NOX.gas$`HEAVY DUTY GAS URBAN BUSES (UBG)`)
NOX.gas$`SCHOOL BUSES - GAS (SBG)`<-as.numeric(NOX.gas$`SCHOOL BUSES - GAS (SBG)`)
NOX.gas$`OTHER BUSES - GAS (OBG)` <-as.numeric(NOX.gas$`OTHER BUSES - GAS (OBG)`)
NOX.gas$`MOTOR HOMES (MH)`<-as.numeric(NOX.gas$`MOTOR HOMES (MH)`)

NOX.gas$sum <- NOX.gas$`LIGHT DUTY PASSENGER (LDA)`+ NOX.gas$`LIGHT DUTY TRUCKS - 1 (LDT1)`+NOX.gas$`LIGHT DUTY TRUCKS - 2 (LDT2)`+ NOX.gas$`MEDIUM DUTY TRUCKS (MDV)`+NOX.gas$`LIGHT HEAVY DUTY GAS TRUCKS - 1 (LHDGT1)`+NOX.gas$`LIGHT HEAVY DUTY GAS TRUCKS - 2 (LHDGT2)`+ NOX.gas$`MEDIUM HEAVY DUTY GAS TRUCKS (MHDGT)`+ NOX.gas$`HEAVY HEAVY DUTY GAS TRUCKS (HHDGT)`+ NOX.gas$`MOTORCYCLES (MCY)`+NOX.gas$`HEAVY DUTY GAS URBAN BUSES (UBG)`+NOX.gas$`SCHOOL BUSES - GAS (SBG)`+NOX.gas$`OTHER BUSES - GAS (OBG)`+NOX.gas$`MOTOR HOMES (MH)`

ds5 <- data.frame(NOX.diesel$Year,NOX.diesel$sum,VehicleNumber.Fuel$Diesel_Diesel_Hybrid,NOX.gas$sum,VehicleNumber.Fuel$Gasoline)
ds5$Quantity.diesel <-ds5$VehicleNumber.Fuel.Diesel_Diesel_Hybrid
ds5$Emission.diesel <-ds5$NOX.diesel.sum
ds5$Quantity.gas <-ds5$VehicleNumber.Fuel.Gasoline
ds5$Emission.gas <-ds5$NOX.gas.sum

ds5$Quantity.diesel <- as.numeric(ds4$Quantity.diesel)
ds5$Quantity.gas <- as.numeric(ds4$Quantity.gas)

reg3 <- lm(data = ds4, Emission.diesel ~ Quantity.diesel)
summary(reg3)

reg4 <- lm(ds4$Emission.gas ~ ds4$Quantity.gas)
summary(reg4)


#Multivariable regression: which type of truck produce more emission
#COT
COT$Year <- c("2018", "2019", "2020", "2021", "2022")
COT$Year <- as.Date(COT$Year, format = "%Y")
COT$Year <- year(COT$Year)
COT$`LIGHT DUTY PASSENGER (LDA)` <- as.numeric(COT$`LIGHT DUTY PASSENGER (LDA)`)
COT$`LIGHT DUTY TRUCKS - 1 (LDT1)` <- as.numeric(COT$`LIGHT DUTY TRUCKS - 1 (LDT1)`)
COT$`LIGHT DUTY TRUCKS - 2 (LDT2)` <- as.numeric(COT$`LIGHT DUTY TRUCKS - 2 (LDT2)`)
COT$`MEDIUM DUTY TRUCKS (MDV)` <- as.numeric(COT$`MEDIUM DUTY TRUCKS (MDV)`)
COT$`LIGHT HEAVY DUTY GAS TRUCKS - 1 (LHDGT1)` <- as.numeric(COT$`LIGHT HEAVY DUTY GAS TRUCKS - 1 (LHDGT1)`)
COT$`LIGHT HEAVY DUTY GAS TRUCKS - 2 (LHDGT2)` <- as.numeric(COT$`LIGHT HEAVY DUTY GAS TRUCKS - 2 (LHDGT2)`)
COT$`MEDIUM HEAVY DUTY GAS TRUCKS (MHDGT)` <- as.numeric(COT$`MEDIUM HEAVY DUTY GAS TRUCKS (MHDGT)`)
COT$`HEAVY HEAVY DUTY GAS TRUCKS (HHDGT)` <- as.numeric(COT$`HEAVY HEAVY DUTY GAS TRUCKS (HHDGT)`)
COT$`LIGHT HEAVY DUTY DIESEL TRUCKS - 1 (LHDDT1)` <- as.numeric(COT$`LIGHT HEAVY DUTY DIESEL TRUCKS - 1 (LHDDT1)`)
COT$`LIGHT HEAVY DUTY DIESEL TRUCKS - 2 (LHDDT2)` <- as.numeric(COT$`LIGHT HEAVY DUTY DIESEL TRUCKS - 2 (LHDDT2)`)
COT$`MEDIUM HEAVY DUTY DIESEL TRUCKS (MHDDT)` <- as.numeric(COT$`MEDIUM HEAVY DUTY DIESEL TRUCKS (MHDDT)`)
COT$`HEAVY HEAVY DUTY DIESEL TRUCKS (HHDDT)` <- as.numeric(COT$`HEAVY HEAVY DUTY DIESEL TRUCKS (HHDDT)`)
COT$`MOTORCYCLES (MCY)` <- as.numeric(COT$`MOTORCYCLES (MCY)`)
COT$`HEAVY DUTY DIESEL URBAN BUSES (UBD)` <- as.numeric(COT$`HEAVY DUTY DIESEL URBAN BUSES (UBD)`)
COT$`HEAVY DUTY GAS URBAN BUSES (UBG)` <- as.numeric(COT$`HEAVY DUTY GAS URBAN BUSES (UBG)`)
COT$`SCHOOL BUSES - GAS (SBG)` <- as.numeric(COT$`SCHOOL BUSES - GAS (SBG)`)
COT$`SCHOOL BUSES - DIESEL (SBD)` <- as.numeric(COT$`SCHOOL BUSES - DIESEL (SBD)`)
COT$`OTHER BUSES - GAS (OBG)` <- as.numeric(COT$`OTHER BUSES - GAS (OBG)`)
COT$`OTHER BUSES - MOTOR COACH - DIESEL (OBC)` <- as.numeric(COT$`OTHER BUSES - MOTOR COACH - DIESEL (OBC)`)
COT$`ALL OTHER BUSES - DIESEL (OBD)` <- as.numeric(COT$`ALL OTHER BUSES - DIESEL (OBD)`)
COT$`MOTOR HOMES (MH)` <- as.numeric(COT$`MOTOR HOMES (MH)`)

rowSums(COT[ , c(2:22)], na.rm=TRUE)

ds6 <- 
  COT%>%
  mutate(Total_Emission = c(1844.808, 1694.213, 1570.754, 1464.898, 1365.674))

reg6 <- lm(data = ds6, 
           Total_Emission ~  `HEAVY DUTY DIESEL URBAN BUSES (UBD)` + `OTHER BUSES - MOTOR COACH - DIESEL (OBC)` + `ALL OTHER BUSES - DIESEL (OBD)`)
summary(reg6)
#Two few data to have meaningful results
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
